<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: clinicalServiceFactory.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: clinicalServiceFactory.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>#!/usr/bin/env node

'use strict';

const AllergyService = require('./allergies/allergyService');
const ProblemService = require('./problems/problemService');
const VitalsService = require('./vitals/vitalsService');

/**
 *
 * The clinical service factory is used to create clinical service instances. Each clinical domain has its own
 * clinical service implementation.
 *
 * A clinical service factory keeps state by maintaining an internal service context object. This context object is
 * passed to a clinical service upon creation of the service instance.
 *
 * The userId and facilityId values are immutable and passed to the constructor.
 *
 * The patientId is mutable and can be changed through the selectPatient method.
 *
 */
class ClinicalServiceFactory {
    /**
     * Clinical service factory constructor.
     *
     * @param {Object} db VistA database instance.
     * @param {String} userId User identifier (e.g. 200-61)
     * @param {String} facilityId Facility identifier. (e.g. 4-2536)
     */
    constructor(db, userId, facilityId) {
        this.db = db;

        this.serviceContext = { // set user and facility ids in the service context
            userId,
            facilityId,
        };

        // private methods

        // security checks
        this.checkForUser = function checkForUser() {
            if (!this.serviceContext.userId || !this.serviceContext.facilityId) {
                throw new Error('No authenticated user');
            }
        };

        this.checkForUserAndPatient = function checkForUserAndPatient() {
            this.checkForUser();

            if (!this.serviceContext.patientId) {
                throw new Error('No selected patient');
            }
        };
    }

    /**
     * Selects a patient.
     *
     * This method currently just stores the provided patientId in the object's serviceContext.
     *
     * It does not communicate with fileman yet.
     *
     * TODO set patient TMP fileman values
     *
     * @param {String} patientId Patient identifier. (e.g. 2-61)
     */
    selectPatient(patientId) {
        this.checkForUser();

        // clear out patient context
        this.serviceContext.patientId = patientId;
    }

    /**
     * Creates an AllergyService instance.
     *
     * @returns {AllergyService} An AllergyService instance.
     * @throws Error if user hasn't been authenticated or a patient hasn't been selected.
     */
    createAllergyService() {
        this.checkForUserAndPatient();

        return new AllergyService(this.db, this.serviceContext);
    }

    /**
     * Creates a ProblemService instance.
     *
     * @returns {ProblemService} A ProblemService instance.
     * @throws Error if user hasn't been authenticated or a patient hasn't been selected.
     */
    createProblemService() {
        this.checkForUserAndPatient();

        return new ProblemService(this.db, this.serviceContext);
    }

    /**
     * Creates a VitalsService instance.
     *
     * @returns {VitalsService} A VitalsService instance.
     * @throws Error if user hasn't been authenticated or a patient hasn't been selected.
     */
    createVitalsService() {
        this.checkForUserAndPatient();

        return new VitalsService(this.db, this.serviceContext);
    }
}

module.exports = ClinicalServiceFactory;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AbstractService.html">AbstractService</a></li><li><a href="AllergyService.html">AllergyService</a></li><li><a href="ClinicalServiceFactory.html">ClinicalServiceFactory</a></li><li><a href="ProblemService.html">ProblemService</a></li><li><a href="VitalsService.html">VitalsService</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Mon Apr 03 2017 16:21:04 GMT+0000 (UTC)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
